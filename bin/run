#!/usr/bin/env node

if (typeof process.env.DEBUG === 'undefined') {
  process.env.DEBUG = 'gen,gen:*';
}

/** Setup Environment **/
if (!process.env.NO_BABEL_HOOK) {
  require('babel-register');
}

/** Load Configuration File **/
const fs = require('fs');
const path = require('path');

let config;
const configPath = path.join(__dirname, '..', 'config.json');

if (!fs.existsSync(configPath)) {
  config = {
    oldPackageThreshold: 604800,
    mongo: 'mongodb://127.0.0.1:21707/gsdb'
  };

  fs.writeFileSync(configPath, JSON.stringify(config));
} else {
  try {
    config = JSON.parse(fs.readFileSync(configPath));
  } catch (err) {
    console.log('Failed to load configuration file: ' + configPath);
    throw err;
  }
}

console.log('Loaded configuration: ' + configPath);

/** Run **/
const generator = new (require('../lib/generator')['default'])(config);

generator.run();